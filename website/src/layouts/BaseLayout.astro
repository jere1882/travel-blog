---
interface Props {
  title: string;
  description?: string;
  lang?: 'en' | 'es';
}

const { title, description = "Jere's Travel Chronicles - 10 Years of Stories from Every Corner of the World", lang = 'en' } = Astro.props;

// Get current path for language switching
const currentPath = Astro.url.pathname;
const isSpanish = currentPath.startsWith('/es');
const currentLang = isSpanish ? 'es' : 'en';

// Generate alternate language path
const getAltPath = () => {
  if (isSpanish) {
    return currentPath.replace(/^\/es/, '') || '/';
  } else {
    return '/es' + currentPath;
  }
};
const altPath = getAltPath();
---

<!DOCTYPE html>
<html lang={currentLang}>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <title>{title}</title>
</head>
<body data-lang={currentLang}>
  <header class="header">
    <div class="container header-inner">
      <nav class="nav-main">
        <ul class="nav-links">
          <li><a href={isSpanish ? "/es" : "/"}>{isSpanish ? "Inicio" : "Home"}</a></li>
          <li><a href={isSpanish ? "/es/trips" : "/trips"}>{isSpanish ? "Todos los Viajes" : "All Trips"}</a></li>
        </ul>
      </nav>
      <nav class="nav-tags">
        <ul class="nav-links nav-links-tags">
          <li><a href={isSpanish ? "/es/tag/medieval" : "/tag/medieval"} class="tag-link">Medieval</a></li>
          <li><a href={isSpanish ? "/es/tag/diving" : "/tag/diving"} class="tag-link">{isSpanish ? "Buceo" : "Diving"}</a></li>
          <li><a href={isSpanish ? "/es/tag/castle" : "/tag/castle"} class="tag-link">{isSpanish ? "Castillo" : "Castle"}</a></li>
          <li><a href={isSpanish ? "/es/tag/harry_potter" : "/tag/harry_potter"} class="tag-link">Harry Potter</a></li>
          <li><a href={isSpanish ? "/es/tags" : "/tags"} class="tag-link tag-link-all">{isSpanish ? "Todas" : "All Tags"}</a></li>
        </ul>
      </nav>
      <div class="nav-right">
        <div class="nav-search">
          <input 
            type="text" 
            class="header-search-input" 
            placeholder={isSpanish ? "Buscar..." : "Search..."}
            id="header-search"
          />
        </div>
        <div class="lang-toggle">
          <a href={isSpanish ? altPath : currentPath} class={`lang-btn ${!isSpanish ? 'active' : ''}`}>EN ðŸ‡¬ðŸ‡§</a>
          <span class="lang-sep">|</span>
          <a href={isSpanish ? currentPath : altPath} class={`lang-btn ${isSpanish ? 'active' : ''}`}>ES ðŸ‡¦ðŸ‡·</a>
        </div>
      </div>
    </div>
  </header>
  
  <script>
    const headerSearch = document.getElementById('header-search');
    const isSpanish = document.body.dataset.lang === 'es';
    const basePath = isSpanish ? '/es' : '';
    
    headerSearch?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const query = (e.target as HTMLInputElement).value.trim();
        if (query) {
          window.location.href = `${basePath}/trips?search=${encodeURIComponent(query)}`;
        } else {
          window.location.href = `${basePath}/trips`;
        }
      }
    });
  </script>

  <main>
    <slot />
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; {new Date().getFullYear()} {isSpanish ? "CrÃ³nicas Viajeras" : "Jere's Travel Chronicles"}</p>
    </div>
  </footer>
</body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>

